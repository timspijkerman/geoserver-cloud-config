# General configuration imports
spring.config.import:
  - geoserver_spring.yml
  - geoserver_logging.yml

spring:
  main:
    banner-mode: "console"
  banner:
    content: "==== GEOSERVER YAML APPLIED ===="
  cache:
    type: caffeine
    caffeine:
      spec: softValues,initialCapacity=10000,maximumSize=10000,recordStats

geoserver:
  debug:
    instanceId: false
  acl:
    enabled: true
    client:
      basePath: ${ACL_URL:http://acl:8080/acl/api}
      username: ${ACL_USERNAME:geoserver}
      password: ${ACL_PASSWORD:s3cr3t}
      caching: true
      initTimeout: 10
  metrics:
    enabled: true
    instance-id: ${info.instance-id}
  security:
    enabled: true
    authkey: true
    gateway-shared-auth:
      enabled: false
      auto: true
      server: false
  catalog:
    advertised: true
    localWorkspace: true
    isolated: true
    secure: true
    caching.enabled: false
  bus:
    enabled: true
    send-events: true
    send-object: ${geoserver.backend.data-directory.enabled}
    send-diff: ${geoserver.backend.data-directory.enabled}
  backend:
    data-directory:
      enabled: ${backend.data-directory:false}
      location: ${GEOSERVER_DATA_DIR:/opt/app/data_directory}
      parallel-loader: true
      eventual-consistency:
        enabled: true
        retries: 25, 25, 50
    pgconfig:
      enabled: true
      initialize: true
      schema: ${PG_SCHEMA:public}
      create-schema: true
      datasource:
        url: "jdbc:postgresql://${PG_HOST:caeli-pgdb.c4dnsyndftht.eu-west-1.rds.amazonaws.com}:${PG_PORT:5432}/${PG_DB:pgconfig}"
        username: ${PG_USERNAME:pgconfig}
        password: ${PG_PASSWORD:pgconfig}
        driverClassname: org.postgresql.Driver
        minimumIdle: 0
        maximumPoolSize: 10
        connectionTimeout: 2500
        idleTimeout: 30000

# Service Targets
targets:
  acl: http://acl:8080
  wfs: http://wfs:8080
  wms: http://wms:8080
  wcs: http://wcs:8080
  wps: http://wps:8080
  rest: http://rest:8080
  gwc: http://gwc:8080
  webui: http://webui:8080

# GeoWebCache Configuration
gwc:
  enabled: true
  cache-directory: ${GEOWEBCACHE_CACHE_DIR:${geoserver.backend.data-directory.location}/gwc}
  rest-config: true
  web-ui: true
  wms-integration: true
  services:
    wmts: true
    tms: true
    wms: true
    kml: true
    gmaps: true
    mgmaps: true
  blobstores:
    azure: true
    s3: true


# Other Backend Profiles
---
spring.config.activate.on-profile: datadir
backend.data-directory: true

# Microservice Profiles
---
spring.config.activate.on-profile: wfs_service
geoserver.security.layergroup-containmentcache: false
---
spring.config.activate.on-profile: wms_service
geoserver.security.layergroup-containmentcache: true
---
spring.config.activate.on-profile: wcs_service
geoserver.security.layergroup-containmentcache: false
---
spring.config.activate.on-profile: wps_service
geoserver.security.layergroup-containmentcache: false
---
spring.config.activate.on-profile: restconfig_service
geoserver.security.layergroup-containmentcache: false
---
spring.config.activate.on-profile: gwc_service
geoserver.security.layergroup-containmentcache: true
---
spring.config.activate.on-profile: webui_service
geoserver:
  security:
    layergroup-containmentcache: true
    gateway-shared-auth.server: false
  web-ui:
    acl.enabled: true
    file-browser.hide-file-system: false
    security.enabled: true
    wfs.enabled: true
    wms.enabled: true
    wcs.enabled: true
    wps.enabled: true
    gwc.enabled: true
    extensions.importer.enabled: false
    demos:
      enabled: true
      wps-request-builder: true
      wcs-request-builder: true
      demo-requests: true
      srs-list: true
      reprojection-console: true
      layer-preview-page.enabled: true
      common-formats:
        open-layers: true
        gml: true
        kml: true
    tools.enabled: true
